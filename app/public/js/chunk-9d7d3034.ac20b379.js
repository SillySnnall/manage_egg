(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-9d7d3034"],{ad02:function(t,e,r){"use strict";function o(t){return{ac:"addBackOrder",customer_code:t.customer_code,shop:t.shop,order_write_code:t.order_write_code,num:t.num,price:t.price,state:t.state,real_price:t.real_price,orderItemList:t.orderItemList}}function i(t){return{ac:"updateBackOrder",code:t.code,customer_code:t.customer_code,shop:t.shop,order_write_code:t.order_write_code,num:t.num,price:t.price,state:t.state,real_price:t.real_price,create_time:t.create_time,orderItemList:t.orderItemList}}function a(t){return{ac:"findBackOrderItem",code:t.code}}function n(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-1",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30;return{ac:"findBackOrder",offset:r,limit:o,searchText:t,searchType:e}}function s(t){return{ac:"deleteBackOrder",code:t.code}}function c(t){return{ac:"stateBackChange",code:t.code,state:t.state}}r.d(e,"a",function(){return o}),r.d(e,"f",function(){return i}),r.d(e,"d",function(){return a}),r.d(e,"c",function(){return n}),r.d(e,"b",function(){return s}),r.d(e,"e",function(){return c})},d5b9:function(t,e,r){"use strict";r.r(e);var o=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("Row",{staticStyle:{"padding-bottom":"16px"},attrs:{gutter:16}},[r("Col",{attrs:{span:"6"}},[r("Input",{on:{input:t.emptysDearchOrder},model:{value:t.inputText,callback:function(e){t.inputText=e},expression:"inputText"}},[r("Select",{staticStyle:{width:"80px"},attrs:{slot:"prepend",transfer:!0},on:{"on-change":t.searchTypeChange},slot:"prepend",model:{value:t.searchType,callback:function(e){t.searchType=e},expression:"searchType"}},[r("Option",{key:"-1",attrs:{value:"-1"}},[t._v("客户名称")]),r("Option",{key:"0",attrs:{value:"0"}},[t._v("未过账")]),r("Option",{key:"3",attrs:{value:"3"}},[t._v("已过账")])],1),r("Button",{attrs:{slot:"append",icon:"ios-search"},on:{click:t.findOrder},slot:"append"})],1)],1),r("Col",{attrs:{span:"2"}},[r("span",{staticStyle:{color:"#ed4014","font-size":"22px"}},[t._v("退货单")])])],1),r("Table",{attrs:{border:"",columns:t.titleList,data:t.tableData},scopedSlots:t._u([{key:"create_time",fn:function(e){var r=e.index;return[t._v(t._s(t.formatDate(t.tableData[r])))]}},{key:"state",fn:function(e){var r=e.index;return[t._v(t._s(t.stateFormat(t.tableData[r])))]}},{key:"action",fn:function(e){var o=e.index;return[r("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small"},on:{click:function(e){return t.editModalClick(t.tableData[o])}}},[t._v("查看")]),r("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"error",size:"small",disabled:3==t.tableData[o].state||0==t.user.authority.substr(4,5)},on:{click:function(e){return t.deleteModal(t.tableData[o])}}},[t._v("删除")]),r("Button",{attrs:{type:"error",size:"small",disabled:3==t.tableData[o].state||0==t.user.authority.substr(0,1)},on:{click:function(e){return t.stateChange(t.tableData[o])}}},[t._v("过账")])]}}])}),t.isShowMoreBtn?r("Button",{staticStyle:{width:"100%"},on:{click:t.loadMore}},[t._v("加载更多")]):t._e(),r("Modal",{attrs:{title:"修改销售单",closable:!1,fullscreen:"","footer-hide":"",closable:"","z-index":99,"class-name":"vertical-center-modal"},model:{value:t.editModal,callback:function(e){t.editModal=e},expression:"editModal"}},[r("Row",{staticStyle:{"padding-bottom":"16px"},attrs:{gutter:16,type:"flex",align:"middle"}},[r("Col",{attrs:{span:"4"}},[r("Input",{attrs:{readonly:"",disabled:"修改"==t.saveBtn},nativeOn:{click:function(e){return t.selectCustomerClick(e)}},model:{value:t.orderData.shop,callback:function(e){t.$set(t.orderData,"shop",e)},expression:"orderData.shop"}},[r("span",{attrs:{slot:"prepend"},slot:"prepend"},[t._v("客户名称")])])],1),r("Col",{staticStyle:{"margin-left":"40px"},attrs:{span:"3"}},[r("h2",[t._v("总数量："+t._s(t.countTotalNum))])]),r("Col",{attrs:{span:"3"}},[r("h2",[t._v("\n          总金额：\n          "),r("span",{staticStyle:{color:"#ed4014"}},[t._v(t._s(t.countTotalPrice))])])]),r("Col",{attrs:{span:"3"}},[r("h2",[t._v("\n          实收金额：\n          "),r("Input",{staticStyle:{color:"#ed4014",width:"100px"},attrs:{type:"number",disabled:"修改"==t.saveBtn},on:{"on-blur":t.formatRealPrice},model:{value:t.orderData.real_price,callback:function(e){t.$set(t.orderData,"real_price",e)},expression:"orderData.real_price"}})],1)]),r("Col",{attrs:{span:"1"}},[r("Button",{attrs:{type:"primary",disabled:3==t.orderData.state||t.user.code!=t.orderData.order_write_code},on:{click:t.saveSure}},[t._v(t._s(t.saveBtn))])],1),r("Col",{attrs:{span:"1"}},[r("Button",{attrs:{type:"primary",disabled:"修改"!=t.saveBtn},on:{click:t.printOrder}},[t._v("打印")])],1)],1),r("Table",{attrs:{border:"",columns:t.editTitleList,data:t.orderData.orderItemList},scopedSlots:t._u([{key:"name",fn:function(e){var o=e.index;return[r("Input",{attrs:{readonly:"",type:"text",disabled:"修改"==t.saveBtn},nativeOn:{click:function(e){return t.selectCommodityClick(o)}},model:{value:t.orderData.orderItemList[o].name,callback:function(e){t.$set(t.orderData.orderItemList[o],"name",e)},expression:"orderData.orderItemList[index].name"}})]}},{key:"specifications",fn:function(e){var r=e.index;return[t._v("1 * "+t._s(t.orderData.orderItemList[r].specifications))]}},{key:"unit",fn:function(e){var o=e.index;return[r("Select",{attrs:{disabled:"修改"==t.saveBtn,transfer:!0},on:{"on-change":function(e){return t.unitChange(t.orderData.orderItemList[o])}},model:{value:t.orderData.orderItemList[o].unit,callback:function(e){t.$set(t.orderData.orderItemList[o],"unit",e)},expression:"orderData.orderItemList[index].unit"}},[r("Option",{key:"个",attrs:{value:"个"}},[t._v("个")]),r("Option",{key:"件",attrs:{value:"件"}},[t._v("件")])],1)]}},{key:"num",fn:function(e){var o=e.index;return[r("Input",{attrs:{type:"number",disabled:"修改"==t.saveBtn},model:{value:t.orderData.orderItemList[o].num,callback:function(e){t.$set(t.orderData.orderItemList[o],"num",e)},expression:"orderData.orderItemList[index].num"}})]}},{key:"price",fn:function(e){var o=e.index;return[r("Input",{attrs:{type:"number",disabled:"修改"==t.saveBtn},on:{"on-blur":function(e){return t.formatItemPrice(t.orderData.orderItemList[o])}},model:{value:t.orderData.orderItemList[o].price,callback:function(e){t.$set(t.orderData.orderItemList[o],"price",e)},expression:"orderData.orderItemList[index].price"}})]}},{key:"total_price",fn:function(e){var r=e.index;return[t._v(t._s(t.countItemTotalPrice(t.orderData.orderItemList[r])))]}},{key:"action",fn:function(e){var o=e.index;return[r("Button",{attrs:{type:"error",size:"small",disabled:"修改"==t.saveBtn},on:{click:function(e){return t.deleteSaleModal(o)}}},[t._v("删除")])]}}])}),r("Button",{staticStyle:{width:"100%"},attrs:{size:"large",disabled:"修改"==t.saveBtn},on:{click:t.addItem}},[t._v("添加商品")])],1),r("Modal",{attrs:{title:"请选择客户",closable:!1,fullscreen:"","footer-hide":"",closable:"","class-name":"vertical-center-modal"},model:{value:t.selectCustomerModal,callback:function(e){t.selectCustomerModal=e},expression:"selectCustomerModal"}},[r("Row",{staticStyle:{"padding-bottom":"16px"},attrs:{gutter:16}},[r("Col",{attrs:{span:"6"}},[r("Input",{on:{input:t.emptysDearchCustomer},model:{value:t.inputCustomerText,callback:function(e){t.inputCustomerText=e},expression:"inputCustomerText"}},[r("Select",{staticStyle:{width:"80px"},attrs:{slot:"prepend"},slot:"prepend",model:{value:t.searchCustomerType,callback:function(e){t.searchCustomerType=e},expression:"searchCustomerType"}},[r("Option",{attrs:{value:"shop"}},[t._v("商店名称")]),r("Option",{attrs:{value:"name"}},[t._v("客户名称")]),r("Option",{attrs:{value:"phone"}},[t._v("电话号码")])],1),r("Button",{attrs:{slot:"append",icon:"ios-search"},on:{click:t.findCustomer},slot:"append"})],1)],1)],1),r("Table",{attrs:{border:"",columns:t.customerTitleList,data:t.customerList},scopedSlots:t._u([{key:"action",fn:function(e){var o=e.row;return[r("Button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.selectCustomerModalBtn(o)}}},[t._v("选择")])]}}])}),t.isCustomerShowMoreBtn?r("Button",{staticStyle:{width:"100%"},on:{click:t.loadCustomerMore}},[t._v("加载更多")]):t._e()],1),r("Modal",{attrs:{title:"请选择商品",closable:!1,fullscreen:"","footer-hide":"",closable:"","class-name":"vertical-center-modal"},model:{value:t.selectCommodityModal,callback:function(e){t.selectCommodityModal=e},expression:"selectCommodityModal"}},[r("Row",{staticStyle:{"padding-bottom":"16px"},attrs:{gutter:16}},[r("Col",{attrs:{span:"6"}},[r("Input",{on:{input:t.emptysDearchCommodity},model:{value:t.inputCommodityText,callback:function(e){t.inputCommodityText=e},expression:"inputCommodityText"}},[r("Select",{staticStyle:{width:"80px"},attrs:{slot:"prepend"},slot:"prepend",model:{value:t.searchCommodityType,callback:function(e){t.searchCommodityType=e},expression:"searchCommodityType"}},[r("Option",{attrs:{value:"name"}},[t._v("商品名称")]),r("Option",{attrs:{value:"bar_code"}},[t._v("条形码")])],1),r("Button",{attrs:{slot:"append",icon:"ios-search"},on:{click:t.findCommodity},slot:"append"})],1)],1)],1),r("Table",{attrs:{border:"",columns:t.commodityTitleList,data:t.commodityList},scopedSlots:t._u([{key:"action",fn:function(e){var o=e.row;return[r("Button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.selectCommodityModalBtn(o)}}},[t._v("选择")])]}}])}),t.isCommodityShowMoreBtn?r("Button",{staticStyle:{width:"100%"},on:{click:t.loadCommodityMore}},[t._v("加载更多")]):t._e()],1)],1)},i=[],a=(r("7f7f"),r("c5f6"),r("bd86")),n=r("0e7a"),s=r("ad02"),c=r("53b7"),d=r("30ef"),l=r("c51d"),u=r("cf51"),m={name:"History",data:function(){var t;return t={user:{},saveBtn:"修改",inputCustomerText:"",searchCustomerType:"shop",customerTitleList:[{type:"index",width:50,align:"center"},{title:"商店名称",key:"shop"},{title:"客户名称",key:"name"},{title:"电话号码",key:"phone"},{title:"地区",key:"region"},{title:"操作",slot:"action",align:"center"}],customerList:[],isCustomerShowMoreBtn:!0,selectCustomerModal:!1,inputCommodityText:"",searchCommodityType:"name",commodityTitleList:[{type:"index",width:50,align:"center"},{title:"商品图片",key:"img_url"},{title:"商店名称",key:"name"},{title:"商品重量",key:"weight"},{title:"商品规格",key:"specifications"},{title:"出产地",key:"home"},{title:"条形码",key:"bar_code"},{title:"保质期",key:"expire"},{title:"进货价格",key:"price_in"},{title:"正发价格",key:"price_out"},{title:"批发价格",key:"price_out_down"},{title:"库存",key:"stock"},{title:"操作",slot:"action",align:"center"}],commodityList:[],isCommodityShowMoreBtn:!0,selectCommodityModal:!1,offset:0,limit:30,readonly:!0,editModal:!1},Object(a["a"])(t,"offset",0),Object(a["a"])(t,"limit",30),Object(a["a"])(t,"isShowMoreBtn",!0),Object(a["a"])(t,"searchType","-1"),Object(a["a"])(t,"inputText",""),Object(a["a"])(t,"titleList",[{type:"index",width:50,align:"center"},{title:"客户名称",key:"shop"},{title:"数量",key:"num"},{title:"金额",key:"price"},{title:"状态",slot:"state"},{title:"创建时间",slot:"create_time"},{title:"操作",slot:"action",align:"center"}]),Object(a["a"])(t,"editTitleList",[{type:"index",width:50,align:"center"},{title:"商品名称",slot:"name"},{title:"条形码",key:"bar_code"},{title:"规格",slot:"specifications"},{title:"单位",slot:"unit"},{title:"数量",slot:"num"},{title:"单价",slot:"price"},{title:"金额",slot:"total_price"},{title:"操作",slot:"action",align:"center"}]),Object(a["a"])(t,"tableData",[]),Object(a["a"])(t,"itemIndex",0),Object(a["a"])(t,"orderData",{code:"",customer_code:"",order_num_code:"",order_delivery_code:"",order_write_code:"",num:0,price:"",price_up:"",shop:"",state:0,real_price:"0.00",create_time:"",orderItemList:[]}),t},mounted:function(){var t=this;d["a"].$on("catBackOrder",function(e){e.code;t.findOrder()})},computed:{formatRealPrice:function(){var t=this;return function(){t.orderData.real_price=Object(c["b"])(t.orderData.real_price)}},formatItemPrice:function(t){return function(t){t.price=Object(c["b"])(t.price)}},countItemTotalPrice:function(t){return function(t){return Object(c["b"])(t.num*t.price)}},countTotalNum:function(){var t=this;return this.orderData.num=0,this.orderData.orderItemList.map(function(e,r){t.orderData.num+=1*e.num}),this.orderData.num},countTotalPrice:function(){var t=0;return this.orderData.orderItemList.map(function(e,r){t+=parseFloat(e.price*e.num)}),this.orderData.price=Object(c["b"])(t),this.orderData.price},formatDate:function(t){return function(t){return Object(c["a"])(new Date(Number(t.create_time)),"yyyy-MM-dd")}},stateFormat:function(t){return function(t){switch(t.state){case 0:return"未过账";case 3:return"已过账"}}}},methods:{stateChange:function(t){var e=this,r=this;this.$Modal.confirm({title:"警告",content:"确定过账此订单？",onOk:function(){t.state=3,e.$Spin.show(),Object(n["a"])(Object(s["e"])(t),function(t){0===t.msg?(r.$Spin.hide(),r.$Message.success("更改成功"),r.offset=0,r.findOrder()):(r.$Spin.hide(),r.$Message.error(t.error))},function(t){r.$Spin.hide(),r.$Message.error(t)})},onCancel:function(){}})},emptysDearchCustomer:function(){""===this.inputCustomerText&&(this.offset=0,this.findCustomer())},loadCustomerMore:function(){this.offset++,this.findCustomer()},selectCustomerModalBtn:function(t){this.orderData.customer_code=t.code,this.orderData.shop=t.shop,this.selectCustomerModal=!1,this.inputCustomerText="",this.searchCustomerType="shop"},emptysDearchCommodity:function(){""===this.inputCommodityText&&(this.offset=0,this.findCommodity())},loadCommodityMore:function(){this.offset++,this.findCommodity()},selectCommodityModalBtn:function(t){var e=this.orderData.orderItemList[this.itemIndex];if(e.commodity_code!=t.code)for(var r=0;r<this.orderData.orderItemList.length;r++)if(t.code===this.orderData.orderItemList[r].commodity_code)return void this.$Message.error("销售单中已有此商品");e.commodity_code=t.code,e.bar_code=t.bar_code,e.specifications=t.specifications,e.price=t.price_in,e.unit="个",e.name=t.name,this.selectCommodityModal=!1,this.inputCommodityText="",this.searchCommodityType="name"},addItem:function(){0==this.orderData.orderItemList.length||""!=this.orderData.orderItemList[this.orderData.orderItemList.length-1].commodity_code?this.orderData.orderItemList.push({code:"",order_code:"",commodity_code:"",num:0,bar_code:"",unit:"个",price:"0.00",specifications:0,name:"",createTime:""}):this.$message.error("上一个条目未选择商品，请选择后再添加新条目")},deleteSaleModal:function(t){var e=this;this.$Modal.confirm({title:"警告",content:"确定删除此商品？",onOk:function(){1!=e.orderData.orderItemList.length?e.orderData.orderItemList.splice(t,1):e.$Message.error("只剩一个条目，无法删除")},onCancel:function(){}})},selectCommodityClick:function(t){"修改"!=this.saveBtn&&(this.offset=0,this.itemIndex=t,this.findCommodity(),this.selectCommodityModal=!0)},selectCustomerClick:function(){"修改"!=this.saveBtn&&(this.offset=0,this.findCustomer(),this.selectCustomerModal=!0)},editModalClick:function(t){this.saveBtn="修改",this.orderData.code=t.code,this.orderData.customer_code=t.customer_code,this.orderData.order_num_code=t.order_num_code,this.orderData.order_delivery_code=t.order_delivery_code,this.orderData.order_write_code=t.order_write_code,this.orderData.num=t.num,this.orderData.price=t.price,this.orderData.price_up=t.price_up,this.orderData.shop=t.shop,this.orderData.state=t.state,this.orderData.real_price=t.real_price,this.orderData.create_time=t.create_time,this.findOrderItem(t),this.editModal=!0},searchTypeChange:function(){this.findOrder()},deleteModal:function(t){var e=this,r=this;this.$Modal.confirm({title:"警告",content:"确定删除此订单？",onOk:function(){e.$Spin.show(),Object(n["a"])(Object(s["b"])(t),function(t){0===t.msg?(r.$Spin.hide(),r.$Message.success("删除成功"),r.offset=0,r.findOrder()):(r.$Spin.hide(),r.$Message.error(t.error))},function(t){r.$Spin.hide(),r.$Message.error(t)})},onCancel:function(){}})},loadMore:function(){this.offset++,this.findOrder()},emptysDearchOrder:function(){""===this.inputText&&(this.offset=0,this.findOrder())},findOrder:function(){var t=this;this.$Spin.show(),Object(n["a"])(Object(s["c"])(t.inputText,t.searchType,t.offset,t.limit),function(e){if(0===e.msg){if(e.data.length<t.limit?t.isShowMoreBtn=!1:t.isShowMoreBtn=!0,0==t.offset)t.tableData=e.data;else for(var r=0;r<e.data.length;r++)t.tableData.push(e.data[r]);t.$Spin.hide()}else t.$Spin.hide(),t.$Message.error(e.error)},function(e){t.$Spin.hide(),t.$Message.error(e)})},findOrderItem:function(t){var e=this;this.$Spin.show(),Object(n["a"])(Object(s["d"])(t),function(t){0===t.msg?(e.orderData.orderItemList=t.data,e.$Spin.hide()):(e.$Spin.hide(),e.$Message.error(t.error))},function(t){e.$Spin.hide(),e.$Message.error(t)})},findCustomer:function(){var t=this;t.$Spin.show(),Object(n["a"])(Object(l["c"])(t.inputCustomerText,t.searchCustomerType,t.offset,t.limit),function(e){if(0===e.msg){if(e.data.length<t.limit?t.isCustomerShowMoreBtn=!1:t.isCustomerShowMoreBtn=!0,0==t.offset)t.customerList=e.data;else for(var r=0;r<e.data.length;r++)t.customerList.push(e.data[r]);t.$Spin.hide()}else t.$Spin.hide(),t.$Message.error(e.error)},function(e){t.$Spin.hide(),t.$Message.error(e)})},findCommodity:function(){var t=this;this.$Spin.show(),Object(n["a"])(Object(u["c"])(t.inputCommodityText,t.searchCommodityType,t.offset,t.limit),function(e){if(0===e.msg){if(e.data.length<t.limit?t.isCommodityShowMoreBtn=!1:t.isCommodityShowMoreBtn=!0,0==t.offset)t.commodityList=e.data;else for(var r=0;r<e.data.length;r++)t.commodityList.push(e.data[r]);t.$Spin.hide()}else t.$Spin.hide(),t.$Message.error(e.error)},function(e){t.$Spin.hide(),t.$Message.error(e)})},unitChange:function(t){"个"===t.unit?0===t.specifications?t.price=Object(c["b"])(0):t.price=Object(c["b"])(t.price/t.specifications):t.price=Object(c["b"])(t.price*t.specifications)},saveSure:function(){var t=this;"修改"==this.saveBtn?this.saveBtn="保存":this.$Modal.confirm({title:"警告",content:"确定保存此订单？",onOk:function(){t.saveOrder()},onCancel:function(){}})},saveOrder:function(){if(null!=this.orderData.customer_code&&""!==this.orderData.customer_code)if(null!=this.orderData.order_write_code&&""!==this.orderData.order_write_code)if(null!=this.orderData.state)if(null!=this.orderData.orderItemList&&0!==this.orderData.orderItemList.length){for(var t=0;t<this.orderData.orderItemList.length;t++){if(null==this.orderData.orderItemList[t].commodity_code||""==this.orderData.orderItemList[t].commodity_code)return void this.$Message.error("有条目未选择商品");if(null==this.orderData.orderItemList[t].num||0==this.orderData.orderItemList[t].num)return void this.$Message.error("有条目未填写商品数量")}var e=this;e.$Spin.show(),Object(n["a"])(Object(s["f"])(this.orderData),function(t){0===t.msg?(e.$Message.success("保存成功"),e.$Spin.hide(),e.saveBtn="修改",e.findOrder()):(e.$Spin.hide(),e.$Message.error(t.error))},function(t){e.$Spin.hide(),e.$Message.error(t)})}else this.$Message.error("订单没有商品");else this.$Message.error("订单状态为空");else this.$Message.error("下单员为空");else this.$Message.error("客户未选择")},printOrder:function(){}},created:function(){null!=sessionStorage.getItem("user")?(this.user=JSON.parse(sessionStorage.getItem("user")),this.findOrder()):this.$router.push({name:"login"})}},p=m,h=r("2877"),f=Object(h["a"])(p,o,i,!1,null,"2e8cc98a",null);e["default"]=f.exports}}]);
//# sourceMappingURL=chunk-9d7d3034.ac20b379.js.map